{
  "comments": [
    {
      "key": {
        "uuid": "b2640ec9_bd884bc7",
        "filename": "src/android.c",
        "patchSetId": 1
      },
      "lineNbr": 778,
      "author": {
        "id": 1003966
      },
      "writtenOn": "2014-02-06T21:28:13Z",
      "side": 1,
      "message": "Did you check this on an upgrade from an Android 4.3 device? On Android 4.3, the format of /data/system/packages.list is different. \n\nSince this code will be executed early on boot, before system_server has had a chance to fixup packages.list, we need to assume it can be in any previously released format.",
      "revId": "e183cec077891371542a5f2e164fcb9ddd745fd8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b2d6ce80_5ec8f58f",
        "filename": "src/android.c",
        "patchSetId": 1
      },
      "lineNbr": 778,
      "author": {
        "id": 1010111
      },
      "writtenOn": "2014-02-06T21:43:08Z",
      "side": 1,
      "message": "No, didn\u0027t test that case or know about this issue (used the run-as code as reference but obviously it doesn\u0027t have to worry about this situation).\nI guess the best we can do in that situation is accept the line and map all entries to the same seinfo value, likely just default, in which case everything will get labeled with app_data_file.  That\u0027s accessible to all app domains currently, whereas platform_app_data_file or radio_data_file or nfc_data_file are only accessible to their respective domains, so I guess it will work but just be less secure.\nWe may also need to incorporate a hash of seapp_contexts into the hash used to decide whether to perform the restorecon_recursive as we are relying upon that in the /data/data case and not just file_contexts.",
      "parentUuid": "b2640ec9_bd884bc7",
      "revId": "e183cec077891371542a5f2e164fcb9ddd745fd8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b2d6ce80_7e485949",
        "filename": "src/android.c",
        "patchSetId": 1
      },
      "lineNbr": 778,
      "author": {
        "id": 1010111
      },
      "writtenOn": "2014-02-06T22:01:55Z",
      "side": 1,
      "message": "Actually, if the line ends with the data directory, then we get an empty string here as the strsep() will terminate on the \\n and yield an empty string rather than NULL and that is ok; it will then fall through matching to the default case and use app_data_file already.",
      "parentUuid": "b2d6ce80_5ec8f58f",
      "revId": "e183cec077891371542a5f2e164fcb9ddd745fd8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f29846f7_9f09b78d",
        "filename": "src/android.c",
        "patchSetId": 1
      },
      "lineNbr": 778,
      "author": {
        "id": 1003966
      },
      "writtenOn": "2014-02-06T22:04:29Z",
      "side": 1,
      "message": "Sorry, I may have been wrong about the format of packages.list. It looks like a 6th column was added, but it\u0027s not relevant from SELinux\u0027s point of view.\n\nIncorporating the seapp_context hash when determining when to relabel makes sense to me.\n\nMy biggest concern at this point is packages.list. As it represents the SELinux context from the *previous* boot, not the SELinux context the app should *currently* be in. This feels problematic for accepting something like https://android-review.googlesource.com/80871 , where we\u0027re moving SELinux domains.\n\nIs this a real concern or just my imagination?",
      "parentUuid": "b2d6ce80_7e485949",
      "revId": "e183cec077891371542a5f2e164fcb9ddd745fd8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b2d6ce80_bee011eb",
        "filename": "src/android.c",
        "patchSetId": 1
      },
      "lineNbr": 778,
      "author": {
        "id": 1010111
      },
      "writtenOn": "2014-02-06T22:08:44Z",
      "side": 1,
      "message": "I was thinking that we still need an explicit restorecon triggered from the PMS/installd when it detects a change in seinfo value.  Then it will also write out the new packages.list and we\u0027ll do the right thing on any future boot restorecons.  But not just the boot restorecon alone.",
      "parentUuid": "f29846f7_9f09b78d",
      "revId": "e183cec077891371542a5f2e164fcb9ddd745fd8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}